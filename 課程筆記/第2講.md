###### tags: `黃能富計算機網路`
#  第2講

# 1.乙太網路介紹
## 全世界佈的最多的有線網路
![](https://hackmd.io/_uploads/ryxxCJMH2.png)

![](https://hackmd.io/_uploads/Hk0B01frh.png)

![](https://hackmd.io/_uploads/Bkz9lgfr2.png)

![](https://hackmd.io/_uploads/Bkzilgzrn.png)
>mac protocal大家都共用link，這個protocal制定誰先送>>CSMA/CD

![](https://hackmd.io/_uploads/HyqHqxzrh.png)

![](https://hackmd.io/_uploads/ry1wcxGB3.png)
## bus是之前的結構了，現在已經從bus改成switch了

>各電腦利用收發器接在同軸電纜上共用

>電腦上傳訊號上去匯往左右傳，到最後旁邊會有終端器接收掉避免回彈造成錯誤

>訊號送上去在電纜上面強度會隨著距離衰減，在乙太網路內最長是500公尺，也就是拉一段區域網路就是500公尺

# 2.transceiver,terminator

![](https://hackmd.io/_uploads/rJfw0gzHh.png)
>每台PC會有一台收發器(目前大多時坐在電腦上)(transceiver)，PC接上去與同軸電纜連接，同時也是連接同軸電纜的去接收訊號
>![](https://hackmd.io/_uploads/SkMg0lMrn.png)

![](https://hackmd.io/_uploads/ryA-eWMHn.png)
>10Base5的意思是這個乙太網路10Mbps傳輸速度且是baseband(一個頻道而已)且每段傳送500公尺

![](https://hackmd.io/_uploads/SkcBIWMSn.png)

# 3.介紹乙太網路之後的版本-10Base2，hub,switch
因為第一代10Base5的電纜非常粗和重，所以改良成細的，但只能送200公尺
![](https://hackmd.io/_uploads/rJgFXX7rn.png)

![](https://hackmd.io/_uploads/ryfsV7XH2.png)
>這邊不錯，可以重聽

![](https://hackmd.io/_uploads/r1lLLQXSn.png)
>集線器(hub)只是為了管理收納的方便但其實跟bus傳輸沒啥區別(全部接到集線器就好，集線器再傳輸出去，以前bus是一條超長同軸電纜在地上，然後各電腦插上去)
>
>集線器只是把訊號再廣播出去，並沒有把封包抓下來處理(濾掉或轉送等等)，沒有網卡，只是對訊號做轉送，單純是一個轉運站，因為沒有網卡無ip，就是廣播在線路上讓目的地電腦自己去取，所以會有碰撞問題，一次只能一台
>
>physical layer的設備

![](https://hackmd.io/_uploads/HyLdw77r2.png)
## 現在乙太網路的結構已經從bus改成switch了

>交換機每個port都有網卡，封包進來有做處理再出去，比較聰明，雍塞繞路，同時送...，且封包不像bus那樣只能一個送，送方和收方有自己一個專線，不會跟別的有衝突，且同條線路雙向也可以同時送
>
>但switch還是CSMA/CD，只是每次聽都是Idle


>本來用cable傳輸，只有同時一台可以送
>
>而switch因為每個port都有一個網卡，有網卡就可以處理路徑，所以每個封包進來，各網卡各自處理，可以同時處理多個封包傳輸

>整理:家裡那種就是交換器，如在同個地方有多台電腦要通訊，可以用不同的線把那些電腦都接到那台交換器，這些電腦就可以利用區域網路進行通訊，而跟其他外部網路通訊不是這裡討論的

# 4 switch詳細講解內部與功用
![](https://hackmd.io/_uploads/HybJMSVHn.png)

![](https://hackmd.io/_uploads/r1-tVSNr2.png)
>難說明，忘了就重看
>
>port可分別不同速度，24+4在這圖表示有24個100M和4個1G的速度
>
>電腦端網卡有自己的速度，switch那端port網卡也有自己的速度，實際傳輸速度取比較小的

>封包進來之後，去查上面的address table得知往哪一個port傳，可平行查和送出封包

# 5. frame的內容格式
frame是Data Link Layer的header加上封包

![](https://hackmd.io/_uploads/BksVvS4r3.png)

![](https://hackmd.io/_uploads/BkB5_rVrn.png)
>Preamble讓接收方得知要送了，校正(一開始先送)
>
>MAC Addresses有48bit，每個網卡全世界不同
>
>type為表示後面data的資料格式內容
>
>FCS封包傳輸會有訊號干擾，使用這個檢查有沒有誤(用前面的做XOR，傳送前做，傳送後檢查有沒有做)

![](https://hackmd.io/_uploads/rJBzjoEB2.png)
>MAC Address跟著網卡走而不是主機
>
>位址長6byte=48bit，然後用16進制+冒號隔開

![](https://hackmd.io/_uploads/HJ4zhj4S3.png)

在乙太網路上，封包廣播會在bus上，每個網卡都可查看，只有DA是自己的才可接收並傳給主機

如frame上的DA(destination Address)是全1，表示是廣播給所有的主機，稱為broadcast address

而如果要送給一些網卡，不是特定一個或全部，則稱為multicast address，第一個bit為1，然後後面47個設定一個做為這些收方的群組位址，不全為1(否則為broadcast address了)

送給特定的網卡就為unicast address
![](https://hackmd.io/_uploads/HyueZhEr2.png)
>網卡會收到的frame

# 6 CSMA與CSMA/CD
![](https://hackmd.io/_uploads/rJKDVh4B3.png)

![](https://hackmd.io/_uploads/HJs8S34B3.png)
>此protocal就是有人在送先不送，沒人送再送

![](https://hackmd.io/_uploads/r1etv3NB3.png)
>但會因距離傳送延遲還是有可能碰撞，橫軸為link，縱軸為時間，圖為b先送，往左右傳，但尚未傳到D，D偵測沒人就傳，之後交會就碰撞了，訊號亂掉(電位會互相加減)，中間重複那塊就錯誤了，**在CSMA碰撞發生不會理他**

>封包因為是很多bit，所以是一直傳，所以黃色才那麼大條，在時間內一直左右傳

![](https://hackmd.io/_uploads/S16-Y24Sn.png)
>CD是Collision detection，在CSMA中加入碰撞偵測功能
>![](https://hackmd.io/_uploads/Hy-FYh4Sn.png)

# 7. CSMA/CD
![](https://hackmd.io/_uploads/BJudCtBSn.png)
![](https://hackmd.io/_uploads/HkzjAKSH3.png)

![](https://hackmd.io/_uploads/ByRfx5HS2.png)

![](https://hackmd.io/_uploads/BJ7dg9SH3.png)

![](https://hackmd.io/_uploads/ryBQWcSr2.png)
>一旦發現封包碰撞了，就多加32bit的jamming sequence，讓所有網卡更加能偵測到這個封包的bit擾亂了，沒用了。

![](https://hackmd.io/_uploads/S1yIf5Srn.png)

>一開始會先傳preamble，發現碰撞馬上+jamming sequence，為最少bit


# 8. Collision Window
訊號在最遠兩端來回傳遞的時間加上一點偵測的時間.其意為只有在此視窗內可能發生衝撞。IEEE 802.3將一個衝撞視窗的時間定為51.2μs。

![](https://hackmd.io/_uploads/Sy2nBsBr2.png)

![](https://hackmd.io/_uploads/HJE0riSH3.png)
>在乙太網路碰撞偵測來回最長時間是51.2us(2500公尺來回時間，沒為甚麼)，用10Mbps來算，就是這段期間要送512bit，因為在傳送封包後，要碰撞偵測，偵測到前封包不能送完，否則會不知道這封包是不是自己的，所以封包至少要64byte=512bit，也就是preamble的長度

**兩個重要數值**
1.封包最少要64byte==512bit，用來偵測碰撞

2.封包最大為1518bytes，為了要公平，讓其他網卡也能送

# 9. Exponential Backoff Algorithm
碰撞後重送的策略

![](https://hackmd.io/_uploads/ryQVehSB3.png)

![](https://hackmd.io/_uploads/SyIngnrH2.png)
>等待完還是要根據CSMA/CD協議去聽Link上有沒有封包在送

送封包的時候也還是要聽，去聽封包有沒有碰撞

# 10. CSMA/CD效能
CSMA/CD這個協議在負載較輕的狀況下運作較佳

在負載重的狀況下，會有太多的網路頻寬資源因為碰撞而浪費掉
![](https://hackmd.io/_uploads/SJf3thHBn.png)
>Loading太重，幾乎沒有封包可以傳成功

**之前使用乙太網路，loading很重的時候，就是致命傷**

## 而現在乙太網路的結構已經從bus改成switch了，就沒有碰撞了

![](https://hackmd.io/_uploads/SJFDh3SSn.png)
>乙太網路802.3這個系列網路的演進

![](https://hackmd.io/_uploads/H1SV6hSrh.png)
>速度演進，但第二層mac layer還是都用CSMA/CD，而要快，線材就必須不一樣，光纖快(光速)，傳統慢就是電纜(cable)
 
## 但switch還是CSMA/CD，只是每次聽都是Idle